/*Copyright (C) 2022-2023 Nurudin Imsirovic <github.com/oxou> Updated: 2022-12-18 05:10 PM*/const bmp_header_parts=[{size:2,data:"BM",addr:0},{addr:2,size:4,data:"\0\0\0\0"},{addr:6,size:2,data:"\0\0"},{addr:8,size:2,data:"\0\0"},{addr:10,size:4,data:"6\0\0\0"},{addr:14,size:4,data:"(\0\0\0"},{addr:18,size:4,data:"\0\0\0\0"},{addr:22,size:4,data:"\0\0\0\0"},{addr:26,size:2,data:"\x01\0"},{addr:28,size:2,data:"\x18\0"},{addr:30,size:4,data:"\0\0\0\0"},{addr:34,size:4,data:"\0\0\0\0"},{addr:38,size:4,data:"\0\0\0\0"},{addr:42,size:4,data:"\0\0\0\0"},{addr:46,size:4,data:"\0\0\0\0"},{addr:50,size:4,data:"\0\0\0\0"},{addr:54,size:-1,data:null}];var bmp_header_parts_size=17;const BMP_HEADER_MAGIC=0,BMP_HEADER_FILESIZE=1,BMP_HEADER_RESERVED1=2,BMP_HEADER_RESERVED2=3,BMP_HEADER_OFFSET=4,BMP_HEADER_HEADERSIZE=5,BMP_HEADER_WIDTH=6,BMP_HEADER_HEIGHT=7,BMP_HEADER_COLORPLANE=8,BMP_HEADER_BITDEPTH=9,BMP_HEADER_COMPRESSION=10,BMP_HEADER_BITMAPSIZE=11,BMP_HEADER_RESHOR=12,BMP_HEADER_RESVER=13,BMP_HEADER_COLORPALETTE=14,BMP_HEADER_IMPORTANTCOLORS=15,BMP_HEADER_DATA=16;function bmp_little_endian_int(e,r=2,t=!0){return e=dechex(e),e=hex2bin(e=(e=(e=str_split(e=t?e.padStart(r,"0"):e.padEnd(r,"0"),2)).reverse()).join(""))}function bmp_little_endian_byte(e){return Number(e=hexdec(e=(e=(e=str_split(e=bin2hex(e),2)).reverse()).join("")))}function bmp_resource_create(e,r){var t=bmp_header_parts,$="",o=e%4,i=bmp_create_array_pixel(e,r),p=e*r*3+r*o;return t.forEach(function(o,i){switch(i){case 1:$+=bmp_little_endian_int(p+54,8);return;case 6:$+=bmp_little_endian_int(e,8);return;case 7:$+=bmp_little_endian_int(r,8);return;case 11:$+=bmp_little_endian_int(p,8);return}null!=t[i].data&&($+=t[i].data)}),{header:byte_to_uint8array($),header_size:$.length,header_raw:$,width:e,height:r,bitmap:i,bitmap_raw:null,bitmap_size:p,padding:o}}function bmp_resource_valid(e,r=!1){var t=r?e:e.header_raw,$=!1;try{$="B"==t[0]&&"M"==t[1]}catch(o){return!1}return $}function bmp_resource_get_pixel(e,r,t){if(r>e.width-1||t>e.height-1||0>r||0>t)return[0,0,0];r=3*Math.floor(r),t=Math.abs((t=3*Math.floor(t))-3*e.height+3);var $=(e.width+e.padding/3)*t+r;$=Math.round($);var o=clamp(Math.floor(Number(e.bitmap[$+0])),0,255),i=clamp(Math.floor(Number(e.bitmap[$+1])),0,255),p=clamp(Math.floor(Number(e.bitmap[$+2])),0,255);return p=isNaN(p)?0:p,i=isNaN(i)?0:i,o=isNaN(o)?0:o,[p,i,o]}function bmp_resource_set_pixel(e,r,t,$=null,o=null,i=null){if(r>e.width-1||t>e.height-1||0>r||0>t)return!0;$=clamp(Math.floor(Number($)),0,255),o=clamp(Math.floor(Number(o)),0,255),i=clamp(Math.floor(Number(i)),0,255),$=isNaN($)?0:$,o=isNaN(o)?0:o,i=isNaN(i)?0:i,r=3*Math.floor(r),t=Math.abs((t=3*Math.floor(t))-3*e.height+3);var p=(e.width+e.padding/3)*t+r;return p=Math.round(p),e.bitmap[p+0]=i,e.bitmap[p+1]=o,e.bitmap[p+2]=$,!0}function bmp_resource_bitmap_to_bytes(e){var r=e.bitmap,t=e.width,$=e.padding,o="";return r=str_split(r=(r=(r=[...r]).map(e=>dechex(e).padStart(2,"0"))).join(""),6*t),o=String("00").repeat($),r=hex2bin(r=r.join(o)+o),e.bitmap_raw=r,!0}function bmp_resource_get_image_size(e){return!!bmp_resource_valid(e)&&[e.width,e.height]}function bmp_resource_get_image_bitmap(e){return!!bmp_resource_valid(e)&&e.bitmap}function bmp_create_array_pixel(e,r){return new Uint8Array(e*r*3+r*(e%4))}function bmp_create_uri(e){var r=new Blob([e.header,e.bitmap],{type:"image/bmp"});return URL.createObjectURL(r)}function bmp_resource_spawn(e,r=null){if(!bmp_resource_valid(e)||null==r)return!1;var t=document.createElement("img");return t.src=bmp_create_uri(e),r.appendChild(t),t}function bmp_resource_replace(e=null,r){return!!(null!=e&&bmp_resource_valid(r))&&(e.src=bmp_create_uri(r),!0)}function bmp_resource_filesize(e){var r=e.width,t=e.height;return Number(r*t*3+t*e.padding+54)}function bmp_resource_create_from_bytes(e){if(!bmp_resource_valid(e,!0))return!1;var r=bmp_little_endian_byte(e.substr(10,4));0>=r&&(r=54);for(var t={magic:0,filesize:1,reserved1:2,reserved2:3,offset:4,headersize:5,width:6,height:7,colorplane:8,bitdepth:9,compression:10,bitmapsize:11,reshor:12,resver:13,colorpalette:14,importantcolors:15,data:16},$=0,o=Object.keys(t);$<bmp_header_parts_size;$++)if(void 0!==t[o[$]]){t[o[$]]={};var i=t[o[$]].addr=bmp_header_parts[$].addr,p=t[o[$]].size=bmp_header_parts[$].size;16==$&&(p=e.length-r,i=r),t[o[$]].data=e.substr(i,p)}var _=t.width.data,n=t.height.data,a=t.bitdepth.data,l=t.data.data,u=0;_=bmp_little_endian_byte(_),n=bmp_little_endian_byte(n),a=bmp_little_endian_byte(a),u=_%4,l=byte_to_uint8array(l);var m=bmp_resource_create(_,n);return m.bitmap=l,m}function bmp_resource_request(e=null){return http_get_bytes(e)}function bmp_resource_copy(e){return!!bmp_resource_valid(e)&&structuredClone(e)}function bmp_resource_download(e,r="download.bmp"){if(!bmp_resource_valid(e))return!1;var t=document.createElement("a");return t.href=bmp_create_uri(e),t.download=r,t.style="display:none",document.body.appendChild(t),t.click(),t.remove(),!0}function hex2bin(e=null){if(null==e)return null;var r=(e=e.toLowerCase()).length;if(r%2)throw"Hexadecimal input string length must be even";for(let t=0;t<r;t++){var $=Number(e.charCodeAt(t));if(!($>47&&$<58||$>96&&$<103))throw"Input string must be hexadecimal"}var o="";for(let i=0;i<r;i+=2)o+=String.fromCharCode(parseInt(e.substr(i,2),16));return o}function bin2hex(e=null){if(null==e)return null;var r=e.length,t="";for(let $=0;$<r;$++){var o=e.charCodeAt($).toString(16);2>o.length&&(o="0"+o),t+=o}return t}function hexdec(e=null){return null==e?null:parseInt(e,16)}function dechex(e=null){return null==e?null:Number(e).toString(16)}function str_split(e,r=1){if(0>=r&&(r=1),1==r)return e.split("");var t=e.length,$=[];for(let o=0;o<t/r;o++)$[o]=e.substr(o*r,r);return $}function clamp(e,r,t){return r>e?r:t<e?t:e}function time(){return Math.floor(Date.now()/1e3)}function time_precise(){return Date.now()}function byte_to_uint8array(e){return e=(e=str_split(e=bin2hex(e),2)).map(e=>hexdec(e)),Uint8Array.from(e)}function uint8array_to_byte(e){return e=(e=(e=[...e]).map(e=>hex2bin(dechex(e).padStart(2,"0")))).join("")}function http_get_bytes(e=null){if(null==e)return!1;var r=new XMLHttpRequest;if(r.open("GET",e,!1),r.overrideMimeType("text/plain; charset=x-user-defined"),r.send(),200!=r.status)return null;for(var t=(data=r.response.split("")).length,$=0;$<t;$++){var o=bin2hex(data[$]);o.length>2&&(o=o.substr(2,2),data[$]=hex2bin(o))}return data.join("")}function bmp_plot_rect(e,r=0,t=0,$=10,o=10,i=255,p=255,_=255){for(let n=t;n<o+t;n++)for(let a=r;a<$+r;a++)e.width>a&&e.height>n&&bmp_resource_set_pixel(e,a,n,i,p,_);return!0}function bmp_plot_clear(e,r=0,t=0,$=0){for(let o=0;o<e.height;o++)for(let i=0;i<e.width;i++)bmp_resource_set_pixel(e,i,o,r,t,$);return!0}function bmp_plot_line(e,r,t,$,o,i=255,p=255,_=255,n=1){n=clamp(n,.1,2);var a=$-r,l=o-t,u=Math.sqrt(a*a+l*l)*n,m=a/u,c=l/u;a=r,l=t;for(let s=0;s<u;s++)e.width>a&&e.height>l&&bmp_resource_set_pixel(e,a,l,i,p,_),a+=m,l+=c;return!0}function bmp_plot_resource(e,r,t=0,$=0,o=-1,i=-1){var r=structuredClone(r);o=clamp(o,-1,r.width),i=clamp(i,-1,r.height),-1==o&&(o=r.width),-1==i&&(i=r.height);for(let p=0;p<o;p++)for(let _=0;_<i;_++)if(e.width>p+t&&e.height>_+$){var n=bmp_resource_get_pixel(r,p,_);bmp_resource_set_pixel(e,p+t,_+$,n[0],n[1],n[2])}return!0}function bmp_plot_text(e,r,t,$,o="A",i=!0,p=255,_=255,n=255,a=-1,l=-1,u=-1){var m=t,c=t,s=$,b=0,d=0,x=r.width/96,f=r.height,h=r.width/x,g=o.length;for(let v=0;v<g;v++){var w=o.charCodeAt(v),E=(w-32)*x;if(10==w||13==w){c=m,s+=f;continue}(32>w||w>126)&&(E=x*(h-1)),i&&c+x>e.width&&(c=m,s+=f);for(let y=d;y<f;y++)for(let z=b;z<x;z++){var A=bmp_resource_get_pixel(r,z+E,y);if(255==A[0]&&255==A[1]&&255==A[2]){if(-1==p||-1==_||-1==n)continue;A[0]=p,A[1]=_,A[2]=n}else if(0==A[0]&&0==A[1]&&0==A[2]){if(-1==a||-1==l||-1==l)continue;A[0]=a,A[1]=l,A[2]=u}e.width>c+z&&e.height>s+y&&bmp_resource_set_pixel(e,c+z,s+y,A[0],A[1],A[2])}c+=x}return!0}function bmp_plot_circle(e,r,t,$,o,i,p,_,n=1){var a=[[247,1],[312,8],[360,23],[403,47],[439,78],[469,114],[490,153],[507,205],[511,257],[505,312],[490,360],[466,403],[435,439],[399,469],[360,490],[308,507],[256,511],[201,505],[153,490],[110,466],[74,435],[44,399],[23,360],[6,308],[2,256],[8,201],[23,153],[47,110],[78,74],[114,44],[153,23],[205,6],[247,1]];for(let l=1;l<33;l++){var u,m=a[l-1],c=a[l],s=m[0]/512*$+r,b=m[1]/512*o+t;bmp_plot_line(e,s,b,c[0]/512*$+r,c[1]/512*o+t,i,p,_,n)}return!0}function bmp_plot_arrow_up(e,r,t,$,o,i,p,_,n=1){var a=[[256,1],[512,256],[384,256],[384,512],[128,512],[128,256],[1,256],[256,1]];for(let l=1;l<8;l++){var u,m=a[l-1],c=a[l],s=m[0]/512*$+r,b=m[1]/512*o+t;bmp_plot_line(e,s,b,c[0]/512*$+r,c[1]/512*o+t,i,p,_,n)}return!0}function bmp_plot_arrow_down(e,r,t,$,o,i,p,_,n=1){var a=[[128,0],[384,0],[384,256],[512,256],[256,512],[0,256],[128,256],[128,0]];for(let l=1;l<8;l++){var u,m=a[l-1],c=a[l],s=m[0]/512*$+r,b=m[1]/512*o+t;bmp_plot_line(e,s,b,c[0]/512*$+r,c[1]/512*o+t,i,p,_,n)}return!0}function bmp_plot_arrow_left(e,r,t,$,o,i,p,_,n=1){var a=[[0,256],[256,0],[256,128],[512,128],[512,384],[256,384],[256,512],[0,256]];for(let l=1;l<8;l++){var u,m=a[l-1],c=a[l],s=m[0]/512*$+r,b=m[1]/512*o+t;bmp_plot_line(e,s,b,c[0]/512*$+r,c[1]/512*o+t,i,p,_,n)}return!0}function bmp_plot_arrow_right(e,r,t,$,o,i,p,_,n=1){var a=[[0,128],[256,128],[256,0],[512,256],[256,512],[256,384],[0,384],[0,128]];for(let l=1;l<8;l++){var u,m=a[l-1],c=a[l],s=m[0]/512*$+r,b=m[1]/512*o+t;bmp_plot_line(e,s,b,c[0]/512*$+r,c[1]/512*o+t,i,p,_,n)}return!0}function bmp_plot_triangle(e,r,t,$,o,i,p,_,n=1){var a=[[256,0],[512,512],[0,512],[256,0]];for(let l=1;l<4;l++){var u,m=a[l-1],c=a[l],s=m[0]/512*$+r,b=m[1]/512*o+t;bmp_plot_line(e,s,b,c[0]/512*$+r,c[1]/512*o+t,i,p,_,n)}return!0}function bmp_mod_get_channel(e,r=0){r=clamp(r,0,2);var t=bmp_resource_create(e.width,e.height);for(let $=0;$<e.height;$++)for(let o=0;o<e.width;o++){var i=bmp_resource_get_pixel(e,o,$);bmp_resource_set_pixel(t,o,$,i[r],i[r],i[r])}return t}function bmp_mod_dissect_font(e){var r=e.width/96,t=e.height,$=e.width/r;return[r,t,$]}function bmp_mod_flip_x(e){var r=e.width,t=e.height,$=bmp_resource_create(r,t);for(let o=0;o<t;o++)for(let i=0;i<r;i++){var p=bmp_resource_get_pixel(e,i,o);bmp_resource_set_pixel($,Math.abs(r-i)-1,o,p[0],p[1],p[2])}return $}function bmp_mod_flip_y(e){var r=e.width,t=e.height,$=bmp_resource_create(r,t);for(let o=0;o<t;o++)for(let i=0;i<r;i++){var p=bmp_resource_get_pixel(e,i,o);bmp_resource_set_pixel($,i,Math.abs(t-o)-1,p[0],p[1],p[2])}return $}function bmp_mod_rotate_right(e){var r=e.width,t=e.height,$=bmp_resource_create(t,r);for(let o=0;o<t;o++)for(let i=0;i<r;i++){var p=bmp_resource_get_pixel(e,i,o);bmp_resource_set_pixel($,Math.abs(t-o)-1,i,p[0],p[1],p[2])}return $}function bmp_mod_rotate_left(e){var r=e.width,t=e.height,$=bmp_resource_create(t,r);for(let o=0;o<t;o++)for(let i=0;i<r;i++){var p=bmp_resource_get_pixel(e,i,o);bmp_resource_set_pixel($,o,Math.abs(r-i)-1,p[0],p[1],p[2])}return $}function bmp_mod_replace_color(e,r,t,$,o,i,p){var _=e.width,n=e.height,a=bmp_resource_copy(e);for(let l=0;l<n;l++)for(let u=0;u<_;u++){var m=bmp_resource_get_pixel(e,u,l);m[0]==r&&m[1]==t&&m[2]==$&&bmp_resource_set_pixel(a,u,l,o,i,p)}return a}function bmp_mod_noise_grayscale(e,r=.1){r=clamp(r,0,10);var t=e.width,$=e.height,o=bmp_resource_copy(e);for(let i=0;i<$;i++)for(let p=0;p<t;p++){var _=bmp_resource_get_pixel(e,p,i),n=Math.floor(Math.random(0)*(255*r));_[0]=clamp(_[0]+n,0,255),_[1]=clamp(_[1]+n,0,255),_[2]=clamp(_[2]+n,0,255),bmp_resource_set_pixel(o,p,i,_[0],_[1],_[2])}return o}function bmp_mod_noise_rgb(e,r=.1){r=clamp(r,0,10);var t=e.width,$=e.height,o=bmp_resource_copy(e);for(let i=0;i<$;i++)for(let p=0;p<t;p++){var _=bmp_resource_get_pixel(e,p,i),n=Math.floor(Math.random(0)*(255*r)),a=Math.floor(Math.random(0)*(255*r)),l=Math.floor(Math.random(0)*(255*r));_[0]=clamp(_[0]+n,0,255),_[1]=clamp(_[1]+a,0,255),_[2]=clamp(_[2]+l,0,255),bmp_resource_set_pixel(o,p,i,_[0],_[1],_[2])}return o}function bmp_mod_color_invert(e){var r=e.width,t=e.height,$=bmp_resource_copy(e);for(let o=0;o<t;o++)for(let i=0;i<r;i++){var p=bmp_resource_get_pixel(e,i,o);p[0]=Math.abs(p[0]-255),p[1]=Math.abs(p[1]-255),p[2]=Math.abs(p[2]-255),bmp_resource_set_pixel($,i,o,p[0],p[1],p[2])}return $}function bmp_mod_color_grayscale(e){var r=e.width,t=e.height,$=bmp_resource_create(r,t);for(let o=0;o<t;o++)for(let i=0;i<r;i++){var p=bmp_resource_get_pixel(e,i,o),p=clamp((p[0]+p[1]+p[2])/3,0,255);bmp_resource_set_pixel($,i,o,p,p,p)}return $}function bmp_mod_color_1bit(e){var r=e.width,t=e.height,$=bmp_resource_create(r,t);for(let o=0;o<t;o++)for(let i=0;i<r;i++){var p=bmp_resource_get_pixel(e,i,o);p=(p=clamp((p[0]+p[1]+p[2])/3,0,255))>127?255:0,bmp_resource_set_pixel($,i,o,p,p,p)}return $}function bmp_mod_noise_grayscale(e,r=.1){r=clamp(r,0,10);var t=e.width,$=e.height,o=bmp_resource_copy(e);for(let i=0;i<$;i++)for(let p=0;p<t;p++){var _=bmp_resource_get_pixel(e,p,i),n=Math.floor(Math.random(0)*(255*r));_[0]=clamp(_[0]+n,0,255),_[1]=clamp(_[1]+n,0,255),_[2]=clamp(_[2]+n,0,255),bmp_resource_set_pixel(o,p,i,_[0],_[1],_[2])}return o}function bmp_mod_noise_rgb(e,r=.1){r=clamp(r,0,10);var t=e.width,$=e.height,o=bmp_resource_copy(e);for(let i=0;i<$;i++)for(let p=0;p<t;p++){var _=bmp_resource_get_pixel(e,p,i),n=Math.floor(Math.random(0)*(255*r)),a=Math.floor(Math.random(0)*(255*r)),l=Math.floor(Math.random(0)*(255*r));_[0]=clamp(_[0]+n,0,255),_[1]=clamp(_[1]+a,0,255),_[2]=clamp(_[2]+l,0,255),bmp_resource_set_pixel(o,p,i,_[0],_[1],_[2])}return o}function bmp_mod_apply_convolution_matrix(e,r=[0,0,0,0,0,0,0,0,0],t=1,$=0){if(9!=r.length&&25!=r.length)throw"Convolution matrix must be of size 3x3 (9) or 5x5 (25)";var o=bmp_resource_copy(e),i=e.width,p=e.height,_=r;if(9==r.length)for(let n=0;n<i;n++)for(let a=0;a<p;a++){var l=bmp_resource_get_pixel(e,n-1,a-1),u=bmp_resource_get_pixel(e,n,a-1),m=bmp_resource_get_pixel(e,n+1,a-1),c=bmp_resource_get_pixel(e,n-1,a),s=bmp_resource_get_pixel(e,n,a),b=bmp_resource_get_pixel(e,n+1,a),d=bmp_resource_get_pixel(e,n-1,a+1),x=bmp_resource_get_pixel(e,n,a+1),f=bmp_resource_get_pixel(e,n+1,a+1);l[0]*=_[0],l[1]*=_[0],l[2]*=_[0],u[0]*=_[1],u[1]*=_[1],u[2]*=_[1],m[0]*=_[2],m[1]*=_[2],m[2]*=_[2],c[0]*=_[3],c[1]*=_[3],c[2]*=_[3],s[0]*=_[4],s[1]*=_[4],s[2]*=_[4],b[0]*=_[5],b[1]*=_[5],b[2]*=_[5],d[0]*=_[6],d[1]*=_[6],d[2]*=_[6],x[0]*=_[7],x[1]*=_[7],x[2]*=_[7],f[0]*=_[8],f[1]*=_[8],f[2]*=_[8];var h=[(l[0]+u[0]+m[0]+c[0]+s[0]+b[0]+d[0]+x[0]+f[0])/t,(l[1]+u[1]+m[1]+c[1]+s[1]+b[1]+d[1]+x[1]+f[1])/t,(l[2]+u[2]+m[2]+c[2]+s[2]+b[2]+d[2]+x[2]+f[2])/t];bmp_resource_set_pixel(o,n,a,h[0]+$,h[1]+$,h[2]+$)}if(25==r.length)for(let g=0;g<i;g++)for(let v=0;v<p;v++){var l=bmp_resource_get_pixel(e,g-2,v-2),u=bmp_resource_get_pixel(e,g-1,v-2),m=bmp_resource_get_pixel(e,g,v-2),w=bmp_resource_get_pixel(e,g+1,v-2),E=bmp_resource_get_pixel(e,g+2,v-2),c=bmp_resource_get_pixel(e,g-2,v-1),s=bmp_resource_get_pixel(e,g-1,v-1),b=bmp_resource_get_pixel(e,g,v-1),y=bmp_resource_get_pixel(e,g+1,v-1),z=bmp_resource_get_pixel(e,g+2,v-1),d=bmp_resource_get_pixel(e,g-2,v),x=bmp_resource_get_pixel(e,g-1,v),f=bmp_resource_get_pixel(e,g,v),A=bmp_resource_get_pixel(e,g+1,v),R=bmp_resource_get_pixel(e,g+2,v),D=bmp_resource_get_pixel(e,g-2,v+1),H=bmp_resource_get_pixel(e,g-1,v+1),B=bmp_resource_get_pixel(e,g,v+1),M=bmp_resource_get_pixel(e,g+1,v+1),P=bmp_resource_get_pixel(e,g+2,v+1),C=bmp_resource_get_pixel(e,g-2,v+2),S=bmp_resource_get_pixel(e,g-1,v+2),T=bmp_resource_get_pixel(e,g,v+2),I=bmp_resource_get_pixel(e,g+1,v+2),O=bmp_resource_get_pixel(e,g+2,v+2);l[0]*=_[0],l[1]*=_[0],l[2]*=_[0],u[0]*=_[1],u[1]*=_[1],u[2]*=_[1],m[0]*=_[2],m[1]*=_[2],m[2]*=_[2],w[0]*=_[3],w[1]*=_[3],w[2]*=_[3],E[0]*=_[4],E[1]*=_[4],E[2]*=_[4],c[0]*=_[5],c[1]*=_[5],c[2]*=_[5],s[0]*=_[6],s[1]*=_[6],s[2]*=_[6],b[0]*=_[7],b[1]*=_[7],b[2]*=_[7],y[0]*=_[8],y[1]*=_[8],y[2]*=_[8],z[0]*=_[9],z[1]*=_[9],z[2]*=_[9],d[0]*=_[10],d[1]*=_[10],d[2]*=_[10],x[0]*=_[11],x[1]*=_[11],x[2]*=_[11],f[0]*=_[12],f[1]*=_[12],f[2]*=_[12],A[0]*=_[13],A[1]*=_[13],A[2]*=_[13],R[0]*=_[14],R[1]*=_[14],R[2]*=_[14],D[0]*=_[15],D[1]*=_[15],D[2]*=_[15],H[0]*=_[16],H[1]*=_[16],H[2]*=_[16],B[0]*=_[17],B[1]*=_[17],B[2]*=_[17],M[0]*=_[18],M[1]*=_[18],M[2]*=_[18],P[0]*=_[19],P[1]*=_[19],P[2]*=_[19],C[0]*=_[20],C[1]*=_[20],C[2]*=_[20],S[0]*=_[21],S[1]*=_[21],S[2]*=_[21],T[0]*=_[22],T[1]*=_[22],T[2]*=_[22],I[0]*=_[23],I[1]*=_[23],I[2]*=_[23],O[0]*=_[24],O[1]*=_[24],O[2]*=_[24];var h=[(l[0]+u[0]+m[0]+w[0]+E[0]+c[0]+s[0]+b[0]+y[0]+z[0]+d[0]+x[0]+f[0]+A[0]+R[0]+D[0]+H[0]+B[0]+M[0]+P[0]+C[0]+S[0]+T[0]+I[0]+O[0])/t,(l[1]+u[1]+m[1]+w[1]+E[1]+c[1]+s[1]+b[1]+y[1]+z[1]+d[1]+x[1]+f[1]+A[1]+R[1]+D[1]+H[1]+B[1]+M[1]+P[1]+C[1]+S[1]+T[1]+I[1]+O[1])/t,(l[2]+u[2]+m[2]+w[2]+E[2]+c[2]+s[2]+b[2]+y[2]+z[2]+d[2]+x[2]+f[2]+A[2]+R[2]+D[2]+H[2]+B[2]+M[2]+P[2]+C[2]+S[2]+T[2]+I[2]+O[2])/t,];bmp_resource_set_pixel(o,g,v,h[0]+$,h[1]+$,h[2]+$)}return o}function bmp_mod_sharpen(e){var r=bmp_resource_copy(e);return bmp_mod_apply_convolution_matrix(r,[0,-1,0,-1,5,-1,0,-1,0])}function bmp_mod_resize(e,r,t){if(r=Math.round(r),t=Math.round(t),r==e.width&&t==e.height)return e;var $=bmp_resource_create(r,t);xd=e.width/r,yd=e.height/t;for(let o=0;o<r;o++)for(let i=0;i<t;i++){var p=bmp_resource_get_pixel(e,xd*o,yd*i);for(let _=0;_<xd;_+=xd)for(let n=0;n<yd;n+=yd)bmp_resource_set_pixel($,o+_,i+n,p[0],p[1],p[2])}return $}function bmp_mod_pixelate(e,r=2){if(1==(r=Math.round(clamp(r,1))))return e;var t=bmp_resource_copy(bmp_resource),$=e.width,o=e.height,i=clamp(Math.round($/r),1),p=clamp(Math.round(o/r),1);return t=bmp_mod_resize(t,i,p),t=bmp_mod_resize(t,$,o)}function bmp_mod_crop(e,r=0,t=0,$=1,o=1,i=0){r=Math.round(Math.abs(r)),t=Math.round(Math.abs(t)),$=Math.round(Math.abs($)),o=Math.round(Math.abs(o)),!i&&(r==$&&++$,t==o&&++o,r>$&&(tx=r,r=$,$=tx),t>o&&(ty=t,t=o,o=ty)),i||($=clamp($,0,e.width),o=clamp(o,0,e.height)),i?(p=$,_=o):(p=Math.round($-r),_=Math.round(o-t));var p,_,n=bmp_resource_create(p,_),a=p+r,l=_+t;for(let u=r;u<a;u++)for(let m=t;m<l;m++){var c=bmp_resource_get_pixel(e,u,m);bmp_resource_set_pixel(n,u-r,m-t,c[0],c[1],c[2])}return n}function bmp_mod_detect_edge(e,r=0){r=clamp(r,0,2);var t=bmp_resource_copy(e);return 0==r&&(t=bmp_mod_apply_convolution_matrix(t,[1,0,-1,0,0,0,-1,0,1])),1==r&&(t=bmp_mod_apply_convolution_matrix(t,[0,1,0,1,-4,1,0,1,0])),2==r&&(t=bmp_mod_apply_convolution_matrix(t,[-1,-1,-1,-1,8,-1,-1,-1,-1])),t}function bmp_mod_blur_box(e){var r=bmp_resource_copy(e);return bmp_mod_apply_convolution_matrix(r,[1,1,1,1,1,1,1,1,1],9)}function bmp_mod_blur_gaussian(e){var r=bmp_resource_copy(e);return bmp_mod_apply_convolution_matrix(r,[1,2,1,2,4,2,1,2,1],16)}function bmp_mod_emboss(e){var r=bmp_resource_copy(e);return bmp_mod_apply_convolution_matrix(r,[-2,-1,0,-1,1,1,0,1,2],9)}