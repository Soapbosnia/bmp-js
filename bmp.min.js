/*Copyright (C) 2022 Nurudin Imsirovic <github.com/oxou> Updated: 2022-10-19 12:42 AM*/function hex2bin(n=null){if(null==n)return null;var t=(n=n.toLowerCase()).length;if(t%2)throw"Hexadecimal input string length must be even";for(let r=0;r<t;r++){var e=Number(n.charCodeAt(r));if(!(e>47&&e<58||e>96&&e<103))throw"Input string must be hexadecimal"}var u="";for(let l=0;l<t;l+=2)u+=String.fromCharCode(parseInt(n.substr(l,2),16));return u}function bin2hex(n=null){if(null==n)return null;var t=n.length,r="";for(let e=0;e<t;e++){var u=n.charCodeAt(e).toString(16);2>u.length&&(u="0"+u),r+=u}return r}function hexdec(n=null){return null==n?null:Number(parseInt(n,16).toString())}function dechex(n=null){return null==n?null:Number(n).toString(16)}function str_split(n,t=1){if(0>=t&&(t=1),1==t)return n.split("");var r=n.length,e=[];for(let u=0;u<r/t;u++)e[u]=n.substr(u*t,t);return e}function clamp(n,t,r){return t>n?t:r<n?r:n}function time(){return Math.floor(Date.now()/1e3)}function time_precise(){return Date.now()}function byte_to_uint8array(n){return n=(n=str_split(n=bin2hex(n),2)).map(n=>hexdec(n)),Uint8Array.from(n)}function uint8array_to_byte(n){return n=(n=(n=[...n]).map(n=>hex2bin(dechex(n).padStart(2,"0")))).join("")}const bmp_header_parts=[{size:2,data:"BM",addr:0},{addr:2,size:4,data:"\0\0\0\0"},{addr:6,size:2,data:"\0\0"},{addr:8,size:2,data:"\0\0"},{addr:10,size:4,data:"6\0\0\0"},{addr:14,size:4,data:"(\0\0\0"},{addr:18,size:4,data:"\0\0\0\0"},{addr:22,size:4,data:"\0\0\0\0"},{addr:26,size:2,data:"\x01\0"},{addr:28,size:2,data:"\x18\0"},{addr:30,size:4,data:"\0\0\0\0"},{addr:34,size:4,data:"\0\0\0\0"},{addr:38,size:4,data:"\0\0\0\0"},{addr:42,size:4,data:"\0\0\0\0"},{addr:46,size:4,data:"\0\0\0\0"},{addr:50,size:4,data:"\0\0\0\0"},{addr:54,size:-1,data:null}];var bmp_header_parts_size=17;const BMP_HEADER_MAGIC=0,BMP_HEADER_FILESIZE=1,BMP_HEADER_RESERVED1=2,BMP_HEADER_RESERVED2=3,BMP_HEADER_OFFSET=4,BMP_HEADER_HEADERSIZE=5,BMP_HEADER_WIDTH=6,BMP_HEADER_HEIGHT=7,BMP_HEADER_COLORPLANE=8,BMP_HEADER_BITDEPTH=9,BMP_HEADER_COMPRESSION=10,BMP_HEADER_BITMAPSIZE=11,BMP_HEADER_RESHOR=12,BMP_HEADER_RESVER=13,BMP_HEADER_COLORPALETTE=14,BMP_HEADER_IMPORTANTCOLORS=15,BMP_HEADER_DATA=16;function bmp_little_endian_int(e,r=2,t=!0){return e=dechex(e),e=hex2bin(e=(e=(e=str_split(e=t?e.padStart(r,"0"):e.padEnd(r,"0"),2)).reverse()).join(""))}function bmp_little_endian_byte(e){return Number(e=hexdec(e=(e=(e=str_split(e=bin2hex(e),2)).reverse()).join("")))}function bmp_resource_create(e,r){var t=bmp_header_parts,a="",$=e%4,i=bmp_create_array_pixel(e,r),n=e*r*3+r*$;return t.forEach(function($,i){switch(i){case 1:a+=bmp_little_endian_int(n+54,8);return;case 6:a+=bmp_little_endian_int(e,8);return;case 7:a+=bmp_little_endian_int(r,8);return;case 11:a+=bmp_little_endian_int(n,8);return}null!=t[i].data&&(a+=t[i].data)}),{header:byte_to_uint8array(a),header_size:a.length,header_raw:a,width:e,height:r,bitmap:i,bitmap_raw:null,bitmap_size:n,padding:$}}function bmp_resource_valid(e,r=!1){var t=r?e:e.header_raw,a=!1;try{a="B"==t[0]&&"M"==t[1]}catch($){return!1}return a}function bmp_resource_get_pixel(e,r,t){if(r>e.width-1||t>e.height-1||0>r||0>t)return[0,0,0];r=3*Math.floor(r),t=Math.abs((t=3*Math.floor(t))-3*e.height+3);var a=(e.width+e.padding/3)*t+r,$=clamp(Math.floor(Number(e.bitmap[a+0])),0,255),i=clamp(Math.floor(Number(e.bitmap[a+1])),0,255),n=clamp(Math.floor(Number(e.bitmap[a+2])),0,255);return n=isNaN(n)?0:n,i=isNaN(i)?0:i,$=isNaN($)?0:$,[n,i,$]}function bmp_resource_set_pixel(e,r,t,a=null,$=null,i=null){if(r>e.width-1||t>e.height-1||0>r||0>t)return!0;a=clamp(Math.floor(Number(a)),0,255),$=clamp(Math.floor(Number($)),0,255),i=clamp(Math.floor(Number(i)),0,255),a=isNaN(a)?0:a,$=isNaN($)?0:$,i=isNaN(i)?0:i,r=3*Math.floor(r),t=Math.abs((t=3*Math.floor(t))-3*e.height+3);var n=(e.width+e.padding/3)*t+r;return e.bitmap[n+0]=i,e.bitmap[n+1]=$,e.bitmap[n+2]=a,!0}function bmp_resource_bitmap_to_bytes(e){var r=e.bitmap,t=e.width,a=e.padding,$="";return r=str_split(r=(r=(r=[...r]).map(e=>dechex(e).padStart(2,"0"))).join(""),6*t),$=String("00").repeat(a),r=hex2bin(r=r.join($)+$),e.bitmap_raw=r,!0}function bmp_resource_get_image_size(e){return!!bmp_resource_valid(e)&&[e.width,e.height]}function bmp_resource_get_image_bitmap(e){return!!bmp_resource_valid(e)&&e.bitmap}function bmp_create_array_pixel(e,r){return new Uint8Array(e*r*3+r*(e%4))}function bmp_create_uri(e){var r=new Blob([e.header,e.bitmap],{type:"image/bmp"});return URL.createObjectURL(r)}function bmp_resource_spawn(e,r=null){if(!bmp_resource_valid(e)||null==r)return!1;var t=document.createElement("img");return t.src=bmp_create_uri(e),r.appendChild(t),t}function bmp_resource_replace(e,r=null){return!!bmp_resource_valid(e)&&null!=r&&(r.src=bmp_create_uri(e),!0)}function bmp_resource_spawn_console(e){var r=bmp_create_uri(e),t=e.width,a=e.height;return console.log("%c "+String(" ").repeat(t),"font-size:"+(t>=a?t:a)+"px;background:url("+r+") no-repeat;width:"+t+"px;height:0px"),!0}function bmp_resource_filesize(e){var r=e.width,t=e.height;return[r*t*3+t*e.padding+54]}function bmp_resource_create_from_bytes(e){if(!bmp_resource_valid(e,!0))return!1;var r=bmp_little_endian_byte(e.substr(10,4));0>=r&&(r=54);for(var t={magic:0,filesize:1,reserved1:2,reserved2:3,offset:4,headersize:5,width:6,height:7,colorplane:8,bitdepth:9,compression:10,bitmapsize:11,reshor:12,resver:13,colorpalette:14,importantcolors:15,data:16},a=0,$=Object.keys(t);a<bmp_header_parts_size;a++)if(void 0!==t[$[a]]){t[$[a]]={};var i=t[$[a]].addr=bmp_header_parts[a].addr,n=t[$[a]].size=bmp_header_parts[a].size;16==a&&(n=e.length-r,i=r),t[$[a]].data=e.substr(i,n)}var d=t.width.data,p=t.height.data,o=t.bitdepth.data,x=t.data.data,s=0;d=bmp_little_endian_byte(d),p=bmp_little_endian_byte(p),o=bmp_little_endian_byte(o),s=d%4,x=byte_to_uint8array(x);var u=bmp_resource_create(d,p);return u.bitmap=x,u}function bmp_resource_request(e=null){if(null==e)return!1;var r=new XMLHttpRequest;if(r.open("GET",e,!1),r.overrideMimeType("text/plain; charset=x-user-defined"),r.send(),200!=r.status)return null;for(var t=(data=r.response.split("")).length,a=0;a<t;a++){var $=bin2hex(data[a]);$.length>2&&($=$.substr(2,2),data[a]=hex2bin($))}return data.join("")}function bmp_resource_copy(e){return!!bmp_resource_valid(e)&&structuredClone(e)}function bmp_resource_download(e,r="download.bmp"){if(!bmp_resource_valid(e))return!1;var t=document.createElement("a");return t.href=bmp_create_uri(e),t.download=r,t.style="display: none",document.body.appendChild(t),t.click(),t.remove(),!0}function bmp_plot_rect(t,e=0,$=0,i=10,r=10,h=255,_=255,o=255){for(let n=$;n<r+$;n++)for(let f=e;f<i+e;f++)t.width>f&&t.height>n&&bmp_resource_set_pixel(t,f,n,h,_,o);return!0}function bmp_plot_clear(t,e=0,$=0,i=0){for(let r=0;r<t.height;r++)for(let h=0;h<t.width;h++)bmp_resource_set_pixel(t,h,r,e,$,i);return!0}function bmp_plot_line(t,e,$,i,r,h=255,_=255,o=255,n=1){n=clamp(n,.1,2);var f=i-e,l=r-$,u=Math.sqrt(f*f+l*l)*n,c=f/u,d=l/u;f=e,l=$;for(let p=0;p<u;p++)t.width>f&&t.height>l&&bmp_resource_set_pixel(t,f,l,h,_,o),f+=c,l+=d;return!0}function bmp_plot_resource(t,e,$=0,i=0,r=-1,h=-1){var e=structuredClone(e);r=clamp(r,-1,e.width),h=clamp(h,-1,e.height),(-1==r||-1==h)&&(r=e.width,h=e.height);for(let _=0;_<h;_++)for(let o=0;o<r;o++)if(t.width>r&&t.height>h){var n=bmp_resource_get_pixel(e,o,_);bmp_resource_set_pixel(t,o+$,_+i,n[0],n[1],n[2])}return!0}function bmp_plot_text(t,e,$,i,r="A",h=!0,_=255,o=255,n=255,f=-1,l=-1,u=-1){var c=$,d=$,p=i,w=0,g=0,a=e.width/96,v=e.height,b=e.width/a,m=r.length;for(let s=0;s<m;s++){var x=r.charCodeAt(s);let A=(x-32)*a;if(10==x||13==x){d=c,p+=v;continue}(32>x||x>126)&&(A=a*(b-1)),h&&d+a>t.width&&(d=c,p+=v);for(let q=g;q<v;q++)for(let C=w;C<a;C++){var E=bmp_resource_get_pixel(e,C+A,q);if(255==E[0]&&255==E[1]&&255==E[2]){if(-1==_||-1==o||-1==n)continue;E[0]=_,E[1]=o,E[2]=n}else if(0==E[0]&&0==E[1]&&0==E[2]){if(-1==f||-1==l||-1==l)continue;E[0]=f,E[1]=l,E[2]=u}t.width>d+C&&t.height>p+q&&bmp_resource_set_pixel(t,d+C,p+q,E[0],E[1],E[2])}d+=a}return!0}function bmp_mod_get_channel(r,t=0){t=clamp(t,0,2);var o=bmp_resource_create(r.width,r.height);for(let $=0;$<r.height;$++)for(let e=0;e<r.width;e++){var n=bmp_resource_get_pixel(r,e,$);bmp_resource_set_pixel(o,e,$,n[t],n[t],n[t])}return o}function bmp_mod_dissect_font(r){var t=r.width/96,o=r.height,$=r.width/t;return[t,o,$]}function bmp_mod_flip_x(r){var t=r.width,o=r.height,$=bmp_resource_create(t,o);for(let e=0;e<o;e++)for(let n=0;n<t;n++){var i=bmp_resource_get_pixel(r,n,e);bmp_resource_set_pixel($,Math.abs(t-n)-1,e,i[0],i[1],i[2])}return $}function bmp_mod_flip_y(r){var t=r.width,o=r.height,$=bmp_resource_create(t,o);for(let e=0;e<o;e++)for(let n=0;n<t;n++){var i=bmp_resource_get_pixel(r,n,e);bmp_resource_set_pixel($,n,Math.abs(o-e)-1,i[0],i[1],i[2])}return $}function bmp_mod_rotate_right(r){var t=r.width,o=r.height,$=bmp_resource_create(o,t);for(let e=0;e<o;e++)for(let n=0;n<t;n++){var i=bmp_resource_get_pixel(r,n,e);bmp_resource_set_pixel($,Math.abs(o-e)-1,n,i[0],i[1],i[2])}return $}function bmp_mod_rotate_left(r){var t=r.width,o=r.height,$=bmp_resource_create(o,t);for(let e=0;e<o;e++)for(let n=0;n<t;n++){var i=bmp_resource_get_pixel(r,n,e);bmp_resource_set_pixel($,e,Math.abs(t-n)-1,i[0],i[1],i[2])}return $}function bmp_mod_replace_color(r,t,o,$,e,n,i){var a=r.width,f=r.height,h=bmp_resource_copy(r);for(let l=0;l<f;l++)for(let d=0;d<a;d++){var m=bmp_resource_get_pixel(r,d,l);m[0]==t&&m[1]==o&&m[2]==$&&bmp_resource_set_pixel(h,d,l,e,n,i)}return h}function bmp_mod_noise_grayscale(r,t=.1){t=clamp(t,0,10);var o=r.width,$=r.height,e=bmp_resource_copy(r);for(let n=0;n<$;n++)for(let i=0;i<o;i++){var a=bmp_resource_get_pixel(r,i,n),f=Math.floor(Math.random(0)*(255*t));a[0]=clamp(a[0]+f,0,255),a[1]=clamp(a[1]+f,0,255),a[2]=clamp(a[2]+f,0,255),bmp_resource_set_pixel(e,i,n,a[0],a[1],a[2])}return e}function bmp_mod_noise_rgb(r,t=.1){t=clamp(t,0,10);var o=r.width,$=r.height,e=bmp_resource_copy(r);for(let n=0;n<$;n++)for(let i=0;i<o;i++){var a=bmp_resource_get_pixel(r,i,n),f=Math.floor(Math.random(0)*(255*t)),h=Math.floor(Math.random(0)*(255*t)),l=Math.floor(Math.random(0)*(255*t));a[0]=clamp(a[0]+f,0,255),a[1]=clamp(a[1]+h,0,255),a[2]=clamp(a[2]+l,0,255),bmp_resource_set_pixel(e,i,n,a[0],a[1],a[2])}return e}function bmp_mod_color_invert(r){var t=r.width,o=r.height,$=bmp_resource_copy(r);for(let e=0;e<o;e++)for(let n=0;n<t;n++){var i=bmp_resource_get_pixel(r,n,e);i[0]=Math.abs(i[0]-255),i[1]=Math.abs(i[1]-255),i[2]=Math.abs(i[2]-255),bmp_resource_set_pixel($,n,e,i[0],i[1],i[2])}return $}function bmp_mod_color_grayscale(r){var t=r.width,o=r.height,$=bmp_resource_create(t,o);for(let e=0;e<o;e++)for(let n=0;n<t;n++){var i=bmp_resource_get_pixel(r,n,e),i=clamp((i[0]+i[1]+i[2])/3,0,255);bmp_resource_set_pixel($,n,e,i,i,i)}return $}function bmp_mod_color_1bit(r){var t=r.width,o=r.height,$=bmp_resource_create(t,o);for(let e=0;e<o;e++)for(let n=0;n<t;n++){var i=bmp_resource_get_pixel(r,n,e);i=(i=clamp((i[0]+i[1]+i[2])/3,0,255))>127?255:0,bmp_resource_set_pixel($,n,e,i,i,i)}return $}function bmp_mod_noise_grayscale(r,t=.1){t=clamp(t,0,10);var o=r.width,$=r.height,e=bmp_resource_copy(r);for(let n=0;n<$;n++)for(let i=0;i<o;i++){var a=bmp_resource_get_pixel(r,i,n),f=Math.floor(Math.random(0)*(255*t));a[0]=clamp(a[0]+f,0,255),a[1]=clamp(a[1]+f,0,255),a[2]=clamp(a[2]+f,0,255),bmp_resource_set_pixel(e,i,n,a[0],a[1],a[2])}return e}function bmp_mod_noise_rgb(r,t=.1){t=clamp(t,0,10);var o=r.width,$=r.height,e=bmp_resource_copy(r);for(let n=0;n<$;n++)for(let i=0;i<o;i++){var a=bmp_resource_get_pixel(r,i,n),f=Math.floor(Math.random(0)*(255*t)),h=Math.floor(Math.random(0)*(255*t)),l=Math.floor(Math.random(0)*(255*t));a[0]=clamp(a[0]+f,0,255),a[1]=clamp(a[1]+h,0,255),a[2]=clamp(a[2]+l,0,255),bmp_resource_set_pixel(e,i,n,a[0],a[1],a[2])}return e}