/*Copyright (C) 2022 Nurudin Imsirovic <github.com/oxou> Updated: 2022-10-09 12:09 AM*/function hex2bin(e=null){if(null==e)return null;var r=(e=e.toLowerCase()).length;if(r%2)throw"Hexadecimal input string length must be even";for(let t=0;t<r;t++){var i=Number(e.charCodeAt(t));if(!(i>47&&i<58||i>96&&i<103))throw"Input string must be hexadecimal"}var a="";for(let n=0;n<r;n+=2)a+=String.fromCharCode(parseInt(e.substr(n,2),16));return a}function bin2hex(e=null){if(null==e)return null;var r=e.length,t="";for(let i=0;i<r;i++){var a=e.charCodeAt(i).toString(16);2>a.length&&(a="0"+a),t+=a}return t}function hexdec(e=null){return null==e?null:Number(parseInt(e,16).toString())}function dechex(e=null){return null==e?null:Number(e).toString(16)}function str_split(e,r=1){if(0>=r&&(r=1),1==r)return e.split("");var t=e.length,i=[];for(let a=0;a<t/r;a++)i[a]=e.substr(a*r,r);return i}function clamp(e,r,t){return r>e?r:t<e?t:e}function time(){return Math.floor(Date.now()/1e3)}function time_precise(){return Date.now()}function byte_to_uint8array(e){return e=(e=str_split(e=bin2hex(e),2)).map(e=>hexdec(e)),Uint8Array.from(e)}function uint8array_to_byte(e){return e=(e=(e=[...e]).map(e=>hex2bin(dechex(e).padStart(2,"0")))).join("")}const bmp_header_parts=[{size:2,data:"BM",addr:0},{addr:2,size:4,data:"6\x03\0\0"},{addr:6,size:2,data:"\0\0"},{addr:8,size:2,data:"\0\0"},{addr:10,size:4,data:"6\0\0\0"},{addr:14,size:4,data:"(\0\0\0"},{addr:18,size:4,data:"\x10\0\0\0"},{addr:22,size:4,data:"\x10\0\0\0"},{addr:26,size:2,data:"\x01\0"},{addr:28,size:2,data:"\x18\0"},{addr:30,size:4,data:"\0\0\0\0"},{addr:34,size:4,data:"\0\x03\0\0"},{addr:38,size:4,data:"\0\0\0\0"},{addr:42,size:4,data:"\0\0\0\0"},{addr:46,size:4,data:"\0\0\0\0"},{addr:50,size:4,data:"\0\0\0\0"},{addr:54,size:-1,data:null}];var bmp_header_parts_size=17;const BMP_HEADER_MAGIC=0,BMP_HEADER_FILESIZE=1,BMP_HEADER_RESERVED1=2,BMP_HEADER_RESERVED2=3,BMP_HEADER_OFFSET=4,BMP_HEADER_HEADERSIZE=5,BMP_HEADER_WIDTH=6,BMP_HEADER_HEIGHT=7,BMP_HEADER_COLORPLANE=8,BMP_HEADER_BITDEPTH=9,BMP_HEADER_COMPRESSION=10,BMP_HEADER_BITMAPSIZE=11,BMP_HEADER_RESHOR=12,BMP_HEADER_RESVER=13,BMP_HEADER_COLORPALETTE=14,BMP_HEADER_IMPORTANTCOLORS=15,BMP_HEADER_DATA=16;function bmp_little_endian_int(e,r=2,t=!0){return e=dechex(e),e=hex2bin(e=(e=(e=str_split(e=t?e.padStart(r,"0"):e.padEnd(r,"0"),2)).reverse()).join(""))}function bmp_little_endian_byte(e){return Number(e=hexdec(e=(e=(e=str_split(e=bin2hex(e),2)).reverse()).join("")))}function bmp_resource_create(e,r){var t=bmp_header_parts,i="",a=e%4,n=bmp_create_array_pixel(e,r),$=e*r*3+r*a;return t.forEach(function(a,n){switch(n){case 1:i+=bmp_little_endian_int($+54,8);return;case 6:i+=bmp_little_endian_int(e,8);return;case 7:i+=bmp_little_endian_int(r,8);return;case 11:i+=bmp_little_endian_int($,8);return}null!==t[n].data&&(i+=t[n].data)}),{header:byte_to_uint8array(i),header_size:i.length,header_raw:i,width:e,height:r,bitmap:n,bitmap_raw:null,bitmap_size:$,padding:a}}function bmp_resource_valid(e,r=!1){var t=r?e:e.header_raw,i=!1;try{i="B"==t[0]&&"M"==t[1]}catch(a){return!1}return i}function bmp_resource_get_pixel(e,r,t){if(r>e.width||t>e.height||0>r||0>t)return[0,0,0];r=3*Math.floor(r),t=Math.abs((t=3*Math.floor(t))-3*e.height+3);var i=e.width*t+r,a=clamp(Math.floor(Number(e.bitmap[i+0])),0,255),n=clamp(Math.floor(Number(e.bitmap[i+1])),0,255),$=clamp(Math.floor(Number(e.bitmap[i+2])),0,255);return $=isNaN($)?0:$,n=isNaN(n)?0:n,a=isNaN(a)?0:a,[$,n,a]}function bmp_resource_set_pixel(e,r,t,i=null,a=null,n=null){if(r>e.width||t>e.height||0>r||0>t)return!0;i=clamp(Math.floor(Number(i)),0,255),a=clamp(Math.floor(Number(a)),0,255),n=clamp(Math.floor(Number(n)),0,255),i=isNaN(i)?0:i,a=isNaN(a)?0:a,n=isNaN(n)?0:n,r=3*Math.floor(r),t=Math.abs((t=3*Math.floor(t))-3*e.height+3);var $=e.width*t+r;return e.bitmap[$+0]=n,e.bitmap[$+1]=a,e.bitmap[$+2]=i,!0}function bmp_resource_bitmap_to_bytes(e){var r=e.bitmap,t=e.width;e.height;var i=e.padding;r=str_split(r=(r=(r=[...r]).map(e=>dechex(e).padStart(2,"0"))).join(""),6*t);var a=String("00").repeat(i);return r=hex2bin(r=r.join(a)+a),e.bitmap_raw=r,!0}function bmp_resource_get_image_size(e){return!!bmp_resource_valid(e)&&[e.width,e.height]}function bmp_resource_get_image_bitmap(e){return!!bmp_resource_valid(e)&&e.bitmap}function bmp_create_array_pixel(e,r){return new Uint8Array(e*r*3)}function bmp_create_uri(e){var r=new Blob([e.header,e.bitmap],{type:"image/bmp"});return URL.createObjectURL(r)}function bmp_resource_spawn(e,r=null){if(!bmp_resource_valid(e)||null==r)return!1;var t=document.createElement("img");return t.src=bmp_create_uri(e),r.appendChild(t),t}function bmp_resource_replace(e,r=null){return!!bmp_resource_valid(e)&&null!=r&&(r.src=bmp_create_uri(e),!0)}function bmp_resource_spawn_console(e){var r=bmp_create_uri(e),t=e.width,i=e.height;return console.log("%c "+String(" ").repeat(t),"font-size:"+(t>=i?t:i)+"px;background:url("+r+") no-repeat;width:"+t+"px;height:0px"),!0}function bmp_resource_filesize(e){var r=e.width,t=e.height,i=e.padding;return[e.header_raw.length+e.bitmap_raw.length,r*t*3+t*i+54]}function bmp_resource_create_from_bytes(e){if(!bmp_resource_valid(e,!0))return!1;var r=bmp_little_endian_byte(e.substr(10,4));0>=r&&(r=54);for(var t={magic:0,filesize:1,reserved1:2,reserved2:3,offset:4,headersize:5,width:6,height:7,colorplane:8,bitdepth:9,compression:10,bitmapsize:11,reshor:12,resver:13,colorpalette:14,importantcolors:15,data:16},i=0,a=Object.keys(t);i<bmp_header_parts_size;i++)if(void 0!==t[a[i]]){t[a[i]]={};var n=t[a[i]].addr=bmp_header_parts[i].addr,$=t[a[i]].size=bmp_header_parts[i].size;16==i&&($=e.length-r,n=r),t[a[i]].data=e.substr(n,$)}var o=t.width.data,l=t.height.data,p=t.bitdepth.data,u=t.data.data,c=0;o=bmp_little_endian_byte(o),l=bmp_little_endian_byte(l),p=bmp_little_endian_byte(p),c=o%4,u=(u=(u=(u=(u=str_split(u,3*o+c)).map(e=>e.substr(0,3*o))).join("")).split("")).map(e=>hexdec(bin2hex(e))),u=Uint8Array.from(u);var s=bmp_resource_create(o,l);return s.bitmap=u,s}function bmp_resource_request(e=null){if(null==e)return!1;var r=new XMLHttpRequest;if(r.open("GET",e,!1),r.overrideMimeType("text/plain; charset=x-user-defined"),r.send(),200!=r.status)return null;for(var t=(data=r.response.split("")).length,i=0;i<t;i++){var a=bin2hex(data[i]);a.length>2&&(a=a.substr(2,2),data[i]=hex2bin(a))}return data.join("")}function bmp_resource_copy(e){return!!bmp_resource_valid(e)&&structuredClone(e)}function bmp_resource_download(e,r="download.bmp"){if(!bmp_resource_valid(e))return!1;var t=document.createElement("a");return t.href=bmp_create_uri(e),t.download=r,t.style="display: none",document.body.appendChild(t),t.click(),t.remove(),!0}function bmp_plot_rect(e,r=0,t=0,i=10,a=10,n=255,$=255,o=255){for(let l=t;l<a+t;l++)for(let p=r;p<i+r;p++)e.width>p&&e.height>l&&bmp_resource_set_pixel(e,p,l,n,$,o);return!0}function bmp_plot_clear(e,r=0,t=0,i=0){for(let a=0;a<e.height;a++)for(let n=0;n<e.width;n++)bmp_resource_set_pixel(e,n,a,r,t,i);return!0}function bmp_plot_line(e,r,t,i,a,n=255,$=255,o=255,l=1){l=clamp(l,.1,2);var p=i-r,u=a-t,c=Math.sqrt(p*p+u*u)*l,s=p/c,d=u/c;p=r,u=t;for(let m=0;m<c;m++)e.width>p&&e.height>u&&bmp_resource_set_pixel(e,p,u,n,$,o),p+=s,u+=d;return!0}function bmp_plot_resource(e,r,t=0,i=0,a=-1,n=-1){var r=structuredClone(r);a=clamp(a,-1,r.width),n=clamp(n,-1,r.height),(-1==a||-1==n)&&(a=r.width,n=r.height);for(let $=0;$<n;$++)for(let o=0;o<a;o++)if(e.width>a&&e.height>n){var l=bmp_resource_get_pixel(r,o,$);bmp_resource_set_pixel(e,o+t,$+i,l[0],l[1],l[2])}return!0}function bmp_plot_text(e,r,t,i,a="A",n=!0,$=255,o=255,l=255,p=-1,u=-1,c=-1){var s=t,d=t,m=i,b=0,h=0,x=r.width/96,f=r.height,_=r.width/x,g=a.length;for(let v=0;v<g;v++){var E=a.charCodeAt(v);let w=(E-32)*x;if(10==E||13==E){d=s,m+=f;continue}(32>E||E>126)&&(w=x*(_-1)),n&&d+x>e.width&&(d=s,m+=f);for(let A=h;A<f;A++)for(let R=b;R<x;R++){var y=bmp_resource_get_pixel(r,R+w,A);if(255==y[0]&&255==y[1]&&255==y[2]){if(-1==$||-1==o||-1==l)continue;y[0]=$,y[1]=o,y[2]=l}else if(0==y[0]&&0==y[1]&&0==y[2]){if(-1==p||-1==u||-1==u)continue;y[0]=p,y[1]=u,y[2]=c}e.width>d+R&&e.height>m+A&&bmp_resource_set_pixel(e,d+R,m+A,y[0],y[1],y[2])}d+=x}return!0}function bmp_mod_get_channel(e,r=0){r=clamp(r,0,2);var t=bmp_resource_create(e.width,e.height);for(let i=0;i<e.height;i++)for(let a=0;a<e.width;a++){var n=bmp_resource_get_pixel(e,a,i);bmp_resource_set_pixel(t,a,i,n[r],n[r],n[r])}return t}function bmp_mod_dissect_font(e){var r=e.width/96,t=e.height,i=e.width/r;return[r,t,i]}function bmp_mod_flip_x(e){var r=e.width,t=e.height,i=bmp_resource_create(r,t);for(let a=0;a<t;a++)for(let n=0;n<r;n++){var $=bmp_resource_get_pixel(e,n,a);bmp_resource_set_pixel(i,Math.abs(r-n)-1,a,$[0],$[1],$[2])}return i}function bmp_mod_flip_y(e){var r=e.width,t=e.height,i=bmp_resource_create(r,t);for(let a=0;a<t;a++)for(let n=0;n<r;n++){var $=bmp_resource_get_pixel(e,n,a);bmp_resource_set_pixel(i,n,Math.abs(t-a)-1,$[0],$[1],$[2])}return i}function bmp_mod_rotate_right(e){var r=e.width,t=e.height,i=bmp_resource_create(t,r);for(let a=0;a<t;a++)for(let n=0;n<r;n++){var $=bmp_resource_get_pixel(e,n,a);bmp_resource_set_pixel(i,Math.abs(t-a)-1,n,$[0],$[1],$[2])}return i}function bmp_mod_rotate_left(e){var r=e.width,t=e.height,i=bmp_resource_create(t,r);for(let a=0;a<t;a++)for(let n=0;n<r;n++){var $=bmp_resource_get_pixel(e,n,a);bmp_resource_set_pixel(i,a,Math.abs(r-n)-1,$[0],$[1],$[2])}return i}function bmp_mod_replace_color(e,r,t,i,a,n,$){var o=e.width,l=e.height,p=bmp_resource_copy(e);for(let u=0;u<l;u++)for(let c=0;c<o;c++){var s=bmp_resource_get_pixel(e,c,u);s[0]==r&&s[1]==t&&s[2]==i&&bmp_resource_set_pixel(p,c,u,a,n,$)}return p}function bmp_mod_noise_grayscale(e,r=.1){r=clamp(r,0,10);var t=e.width,i=e.height,a=bmp_resource_copy(e);for(let n=0;n<i;n++)for(let $=0;$<t;$++){var o=bmp_resource_get_pixel(e,$,n),l=Math.floor(Math.random(0)*(255*r));o[0]=clamp(o[0]+l,0,255),o[1]=clamp(o[1]+l,0,255),o[2]=clamp(o[2]+l,0,255),bmp_resource_set_pixel(a,$,n,o[0],o[1],o[2])}return a}function bmp_mod_noise_rgb(e,r=.1){r=clamp(r,0,10);var t=e.width,i=e.height,a=bmp_resource_copy(e);for(let n=0;n<i;n++)for(let $=0;$<t;$++){var o=bmp_resource_get_pixel(e,$,n),l=Math.floor(Math.random(0)*(255*r)),p=Math.floor(Math.random(0)*(255*r)),u=Math.floor(Math.random(0)*(255*r));o[0]=clamp(o[0]+l,0,255),o[1]=clamp(o[1]+p,0,255),o[2]=clamp(o[2]+u,0,255),bmp_resource_set_pixel(a,$,n,o[0],o[1],o[2])}return a}function bmp_mod_color_invert(e){var r=e.width,t=e.height,i=bmp_resource_copy(e);for(let a=0;a<t;a++)for(let n=0;n<r;n++){var $=bmp_resource_get_pixel(e,n,a);$[0]=Math.abs($[0]-255),$[1]=Math.abs($[1]-255),$[2]=Math.abs($[2]-255),bmp_resource_set_pixel(i,n,a,$[0],$[1],$[2])}return i}function bmp_mod_color_grayscale(e){var r=e.width,t=e.height,i=bmp_resource_create(r,t);for(let a=0;a<t;a++)for(let n=0;n<r;n++){var $=bmp_resource_get_pixel(e,n,a),$=clamp(($[0]+$[1]+$[2])/3,0,255);bmp_resource_set_pixel(i,n,a,$,$,$)}return i}function bmp_mod_color_1bit(e){var r=e.width,t=e.height,i=bmp_resource_create(r,t);for(let a=0;a<t;a++)for(let n=0;n<r;n++){var $=bmp_resource_get_pixel(e,n,a);$=($=clamp(($[0]+$[1]+$[2])/3,0,255))>127?255:0,bmp_resource_set_pixel(i,n,a,$,$,$)}return i}